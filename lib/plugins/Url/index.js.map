{"version":3,"sources":["../../../src/plugins/Url/index.js"],"names":["Plugin","require","Translator","h","RequestClient","UrlUI","module","exports","uppy","opts","id","title","type","icon","defaultLocale","strings","import","enterUrlToImport","failedToFetch","enterCorrectUrl","defaultOptions","locale","translator","i18n","translate","bind","hostname","host","Error","getMeta","addFile","server","getFileNameFromUrl","url","substring","lastIndexOf","checkIfCorrectURL","protocol","match","addProtocolToURL","protocolRegex","defaultProtocol","test","post","then","res","error","log","info","meta","tagFile","source","name","data","size","isRemote","body","remote","fileId","dashboard","getPlugin","hideAllPanels","catch","err","message","details","render","state","install","target","mount","uninstall","unmount"],"mappings":"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","file":"index.js","sourcesContent":["const Plugin = require('../../core/Plugin')\nconst Translator = require('../../core/Translator')\nconst { h } = require('preact')\nconst { RequestClient } = require('../../server')\nconst UrlUI = require('./UrlUI.js')\nrequire('whatwg-fetch')\n\n/**\n * Url\n *\n */\nmodule.exports = class Url extends Plugin {\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'Url'\n    this.title = 'Link'\n    this.type = 'acquirer'\n    this.icon = () => <svg aria-hidden=\"true\" class=\"UppyIcon UppyModalTab-icon\" width=\"64\" height=\"64\" viewBox=\"0 0 64 64\">\n      <circle cx=\"32\" cy=\"32\" r=\"31\" />\n      <g fill-rule=\"nonzero\" fill=\"#FFF\">\n        <path d=\"M25.774 47.357a4.077 4.077 0 0 1-5.76 0L16.9 44.24a4.076 4.076 0 0 1 0-5.758l5.12-5.12-1.817-1.818-5.12 5.122a6.651 6.651 0 0 0 0 9.392l3.113 3.116a6.626 6.626 0 0 0 4.699 1.943c1.7 0 3.401-.649 4.697-1.943l10.241-10.243a6.591 6.591 0 0 0 1.947-4.696 6.599 6.599 0 0 0-1.947-4.696l-3.116-3.114-1.817 1.817 3.116 3.114a4.045 4.045 0 0 1 1.194 2.88 4.045 4.045 0 0 1-1.194 2.878L25.774 47.357z\" />\n        <path d=\"M46.216 14.926a6.597 6.597 0 0 0-4.696-1.946h-.001a6.599 6.599 0 0 0-4.696 1.945L26.582 25.167a6.595 6.595 0 0 0-1.947 4.697 6.599 6.599 0 0 0 1.946 4.698l3.114 3.114 1.818-1.816-3.114-3.114a4.05 4.05 0 0 1-1.194-2.882c0-1.086.424-2.108 1.194-2.878L38.64 16.744a4.042 4.042 0 0 1 2.88-1.194c1.089 0 2.11.425 2.88 1.194l3.114 3.114a4.076 4.076 0 0 1 0 5.758l-5.12 5.12 1.818 1.817 5.12-5.122a6.649 6.649 0 0 0 0-9.393l-3.113-3.114-.003.002z\" />\n      </g>\n    </svg>\n\n    // Set default options and locale\n    const defaultLocale = {\n      strings: {\n        import: 'Import',\n        enterUrlToImport: 'Enter URL to import a file',\n        failedToFetch: 'Uppy Server failed to fetch this URL, please make sure itâ€™s correct',\n        enterCorrectUrl: 'Incorrect URL: Please make sure you are entering a direct link to a file'\n      }\n    }\n\n    const defaultOptions = {\n      locale: defaultLocale\n    }\n\n    this.opts = Object.assign({}, defaultOptions, opts)\n\n    this.locale = Object.assign({}, defaultLocale, this.opts.locale)\n    this.locale.strings = Object.assign({}, defaultLocale.strings, this.opts.locale.strings)\n\n    this.translator = new Translator({locale: this.locale})\n    this.i18n = this.translator.translate.bind(this.translator)\n\n    this.hostname = this.opts.host\n\n    if (!this.hostname) {\n      throw new Error('Uppy Server hostname is required, please consult https://uppy.io/docs/server')\n    }\n\n    // Bind all event handlers for referencability\n    this.getMeta = this.getMeta.bind(this)\n    this.addFile = this.addFile.bind(this)\n\n    this.server = new RequestClient(uppy, {host: this.opts.host})\n  }\n\n  getFileNameFromUrl (url) {\n    return url.substring(url.lastIndexOf('/') + 1)\n  }\n\n  checkIfCorrectURL (url) {\n    if (!url) return false\n\n    const protocol = url.match(/^([a-z0-9]+):\\/\\//)[1]\n    if (protocol !== 'http' && protocol !== 'https') {\n      return false\n    }\n\n    return true\n  }\n\n  addProtocolToURL (url) {\n    const protocolRegex = /^[a-z0-9]+:\\/\\//\n    const defaultProtocol = 'http://'\n    if (protocolRegex.test(url)) {\n      return url\n    }\n\n    return defaultProtocol + url\n  }\n\n  getMeta (url) {\n    return this.server.post('url/meta', { url })\n      .then((res) => {\n        if (res.error) {\n          this.uppy.log('[URL] Error:')\n          this.uppy.log(res.error)\n          throw new Error('Failed to fetch the file')\n        }\n        return res\n      })\n  }\n\n  addFile (url) {\n    url = this.addProtocolToURL(url)\n    if (!this.checkIfCorrectURL(url)) {\n      this.uppy.log(`[URL] Incorrect URL entered: ${url}`)\n      this.uppy.info(this.i18n('enterCorrectUrl'), 'error', 4000)\n      return\n    }\n\n    return this.getMeta(url)\n      .then((meta) => {\n        const tagFile = {\n          source: this.id,\n          name: this.getFileNameFromUrl(url),\n          type: meta.type,\n          data: {\n            size: meta.size\n          },\n          isRemote: true,\n          body: {\n            url: url\n          },\n          remote: {\n            host: this.opts.host,\n            url: `${this.hostname}/url/get`,\n            body: {\n              fileId: url,\n              url: url\n            }\n          }\n        }\n        return tagFile\n      })\n      .then((tagFile) => {\n        this.uppy.log('[Url] Adding remote file')\n        return this.uppy.addFile(tagFile)\n      })\n      .then(() => {\n        const dashboard = this.uppy.getPlugin('Dashboard')\n        if (dashboard) dashboard.hideAllPanels()\n      })\n      .catch((err) => {\n        this.uppy.log(err)\n        this.uppy.info({\n          message: this.i18n('failedToFetch'),\n          details: err\n        }, 'error', 4000)\n      })\n  }\n\n  render (state) {\n    return <UrlUI\n      i18n={this.i18n}\n      addFile={this.addFile} />\n  }\n\n  install () {\n    const target = this.opts.target\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n"]}