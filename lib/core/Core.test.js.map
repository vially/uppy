{"version":3,"sources":["../../src/core/Core.test.js"],"names":["fs","require","path","Core","utils","Plugin","AcquirerPlugin1","AcquirerPlugin2","InvalidPlugin","InvalidPluginWithoutId","InvalidPluginWithoutType","jest","mock","sampleImage","readFileSync","join","__dirname","describe","RealCreateObjectUrl","global","URL","createObjectURL","beforeEach","spyOn","mockImplementation","resolve","toString","createThumbnail","mockClear","fn","mockReturnValue","afterEach","it","core","expect","constructor","name","toEqual","getID","core2","id","use","Object","keys","plugins","acquirer","length","toThrowErrorMatchingSnapshot","getPlugin","plugin","iteratePlugins","run","mocks","calls","removePlugin","uninstall","updateAll","foo","update","stateUpdateEventMock","on","setState","bee","newState","capabilities","resumableUploads","files","currentUploads","info","isHidden","message","type","meta","totalProgress","state","getState","coreCancelEventMock","coreStateUpdateEventMock","reset","_createUpload","toBeDefined","cancelAll","toBeUndefined","close","addPreProcessor","fileIDs","uploadID","addResultData","pre","addPostProcessor","post","addUploader","upload","then","result","toBe","preprocessor","preProcessors","preprocessor1","preprocessor2","preprocessor3","removePreProcessor","addFile","source","data","File","fileId","file","getFile","emit","mode","value","progress","percentage","bytesUploaded","bytesTotal","uploadComplete","uploadStarted","preprocess","fileID","postprocessor","postProcessors","postprocessor1","postprocessor2","postprocessor3","removePostProcessor","substring","postprocess","uploader","uploaders","uploader1","uploader2","uploader3","removeUploader","onBeforeFileAdded","fileData","fileAddedEventMock","newFile","extension","isRemote","preview","undefined","remote","size","restrictions","allowedFileTypes","Error","err","Uint8Array","resolves","toMatchObject","successful","failed","forEach","test","error","store","upload1","upload2","toMatchSnapshot","autoProceed","onBeforeUpload","catch","fileRemovedEventMock","removeFile","xit","getFiles","Buffer","alloc","toHaveLength","map","sort","foo2","setMeta","bur","boo","setFileMeta","resize","_calculateProgress","fileId1","fileId2","file1","file2","Date","_calculateTotalProgress","resetProgressEvent","resetProgress","maxNumberOfFiles","maxFileSize","RealNavigatorOnline","window","navigator","onLine","mockNavigatorOnline","status","defineProperty","writable","onlineEventMock","offlineEventMock","backOnlineEventMock","updateOnlineStatus","infoVisibleEvent","details","infoTimeoutID","done","infoHiddenEvent","setTimeout","hideInfo","uploadId","currentUploadsState","step","locale","strings","i18n","opts","minNumberOfFiles"],"mappings":"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","file":"Core.test.js","sourcesContent":["const fs = require('fs')\nconst path = require('path')\nconst Core = require('./Core')\nconst utils = require('./Utils')\nconst Plugin = require('./Plugin')\nconst AcquirerPlugin1 = require('../../test/mocks/acquirerPlugin1')\nconst AcquirerPlugin2 = require('../../test/mocks/acquirerPlugin2')\nconst InvalidPlugin = require('../../test/mocks/invalidPlugin')\nconst InvalidPluginWithoutId = require('../../test/mocks/invalidPluginWithoutId')\nconst InvalidPluginWithoutType = require('../../test/mocks/invalidPluginWithoutType')\n\njest.mock('cuid', () => {\n  return () => 'cjd09qwxb000dlql4tp4doz8h'\n})\n\nconst sampleImage = fs.readFileSync(path.join(__dirname, '../../test/resources/image.jpg'))\n\ndescribe('src/Core', () => {\n  const RealCreateObjectUrl = global.URL.createObjectURL\n  beforeEach(() => {\n    jest.spyOn(utils, 'findDOMElement').mockImplementation(path => {\n      return 'some config...'\n    })\n    jest.spyOn(utils, 'createThumbnail').mockImplementation(path => {\n      return Promise.resolve(`data:image/jpeg;base64,${sampleImage.toString('base64')}`)\n    })\n    utils.createThumbnail.mockClear()\n\n    global.URL.createObjectURL = jest.fn().mockReturnValue('newUrl')\n  })\n\n  afterEach(() => {\n    global.URL.createObjectURL = RealCreateObjectUrl\n  })\n\n  it('should expose a class', () => {\n    const core = Core()\n    expect(core.constructor.name).toEqual('Uppy')\n  })\n\n  it('should have a string `id` option that defaults to \"uppy\"', () => {\n    const core = Core()\n    expect(core.getID()).toEqual('uppy')\n\n    const core2 = Core({ id: 'profile' })\n    expect(core2.getID()).toEqual('profile')\n  })\n\n  describe('plugins', () => {\n    it('should add a plugin to the plugin stack', () => {\n      const core = Core()\n      core.use(AcquirerPlugin1)\n      expect(Object.keys(core.plugins.acquirer).length).toEqual(1)\n    })\n\n    it('should prevent the same plugin from being added more than once', () => {\n      const core = Core()\n      core.use(AcquirerPlugin1)\n\n      expect(() => {\n        core.use(AcquirerPlugin1)\n      }).toThrowErrorMatchingSnapshot()\n    })\n\n    it('should not be able to add an invalid plugin', () => {\n      const core = Core()\n\n      expect(() => {\n        core.use(InvalidPlugin)\n      }).toThrowErrorMatchingSnapshot()\n    })\n\n    it('should not be able to add a plugin that has no id', () => {\n      const core = Core()\n\n      expect(() =>\n        core.use(InvalidPluginWithoutId)\n      ).toThrowErrorMatchingSnapshot()\n    })\n\n    it('should not be able to add a plugin that has no type', () => {\n      const core = Core()\n\n      expect(() =>\n        core.use(InvalidPluginWithoutType)\n      ).toThrowErrorMatchingSnapshot()\n    })\n\n    it('should return the plugin that matches the specified name', () => {\n      const core = new Core()\n      expect(core.getPlugin('foo')).toEqual(null)\n\n      core.use(AcquirerPlugin1)\n      const plugin = core.getPlugin('TestSelector1')\n      expect(plugin.id).toEqual('TestSelector1')\n      expect(plugin instanceof Plugin)\n    })\n\n    it('should call the specified method on all the plugins', () => {\n      const core = new Core()\n      core.use(AcquirerPlugin1)\n      core.use(AcquirerPlugin2)\n      core.iteratePlugins(plugin => {\n        plugin.run('hello')\n      })\n      expect(core.plugins.acquirer[0].mocks.run.mock.calls.length).toEqual(1)\n      expect(core.plugins.acquirer[0].mocks.run.mock.calls[0]).toEqual([\n        'hello'\n      ])\n      expect(core.plugins.acquirer[1].mocks.run.mock.calls.length).toEqual(1)\n      expect(core.plugins.acquirer[1].mocks.run.mock.calls[0]).toEqual([\n        'hello'\n      ])\n    })\n\n    it('should uninstall and the remove the specified plugin', () => {\n      const core = new Core()\n      core.use(AcquirerPlugin1)\n      core.use(AcquirerPlugin2)\n      expect(Object.keys(core.plugins.acquirer).length).toEqual(2)\n\n      const plugin = core.getPlugin('TestSelector1')\n      core.removePlugin(plugin)\n      expect(Object.keys(core.plugins.acquirer).length).toEqual(1)\n      expect(plugin.mocks.uninstall.mock.calls.length).toEqual(1)\n      expect(core.plugins.acquirer[0].mocks.run.mock.calls.length).toEqual(0)\n    })\n  })\n\n  describe('state', () => {\n    it('should update all the plugins with the new state when the updateAll method is called', () => {\n      const core = new Core()\n      core.use(AcquirerPlugin1)\n      core.use(AcquirerPlugin2)\n      core.updateAll({ foo: 'bar' })\n      expect(core.plugins.acquirer[0].mocks.update.mock.calls.length).toEqual(1)\n      expect(core.plugins.acquirer[0].mocks.update.mock.calls[0]).toEqual([\n        { foo: 'bar' }\n      ])\n      expect(core.plugins.acquirer[1].mocks.update.mock.calls.length).toEqual(1)\n      expect(core.plugins.acquirer[1].mocks.update.mock.calls[0]).toEqual([\n        { foo: 'bar' }\n      ])\n    })\n\n    it('should update the state', () => {\n      const core = new Core()\n      const stateUpdateEventMock = jest.fn()\n      core.on('state-update', stateUpdateEventMock)\n      core.use(AcquirerPlugin1)\n      core.use(AcquirerPlugin2)\n\n      core.setState({ foo: 'bar', bee: 'boo' })\n      core.setState({ foo: 'baar' })\n\n      const newState = {\n        bee: 'boo',\n        capabilities: { resumableUploads: false },\n        files: {},\n        currentUploads: {},\n        foo: 'baar',\n        info: { isHidden: true, message: '', type: 'info' },\n        meta: {},\n        plugins: {},\n        totalProgress: 0\n      }\n\n      expect(core.state).toEqual(newState)\n\n      expect(core.plugins.acquirer[0].mocks.update.mock.calls[1]).toEqual([\n        newState\n      ])\n      expect(core.plugins.acquirer[1].mocks.update.mock.calls[1]).toEqual([\n        newState\n      ])\n\n      expect(stateUpdateEventMock.mock.calls.length).toEqual(2)\n      // current state\n      expect(stateUpdateEventMock.mock.calls[1][0]).toEqual({\n        bee: 'boo',\n        capabilities: { resumableUploads: false },\n        files: {},\n        currentUploads: {},\n        foo: 'bar',\n        info: { isHidden: true, message: '', type: 'info' },\n        meta: {},\n        plugins: {},\n        totalProgress: 0\n      })\n      // new state\n      expect(stateUpdateEventMock.mock.calls[1][1]).toEqual({\n        bee: 'boo',\n        capabilities: { resumableUploads: false },\n        files: {},\n        currentUploads: {},\n        foo: 'baar',\n        info: { isHidden: true, message: '', type: 'info' },\n        meta: {},\n        plugins: {},\n        totalProgress: 0\n      })\n    })\n\n    it('should get the state', () => {\n      const core = new Core()\n\n      core.setState({ foo: 'bar' })\n\n      expect(core.getState()).toEqual({\n        capabilities: { resumableUploads: false },\n        files: {},\n        currentUploads: {},\n        foo: 'bar',\n        info: { isHidden: true, message: '', type: 'info' },\n        meta: {},\n        plugins: {},\n        totalProgress: 0\n      })\n    })\n  })\n\n  it('should reset when the reset method is called', () => {\n    const core = new Core()\n    // const corePauseEventMock = jest.fn()\n    const coreCancelEventMock = jest.fn()\n    const coreStateUpdateEventMock = jest.fn()\n    core.on('cancel-all', coreCancelEventMock)\n    core.on('state-update', coreStateUpdateEventMock)\n    core.setState({ foo: 'bar', totalProgress: 30 })\n\n    core.reset()\n\n    // expect(corePauseEventMock.mock.calls.length).toEqual(1)\n    expect(coreCancelEventMock.mock.calls.length).toEqual(1)\n    expect(coreStateUpdateEventMock.mock.calls.length).toEqual(2)\n    expect(coreStateUpdateEventMock.mock.calls[1][1]).toEqual({\n      capabilities: { resumableUploads: false },\n      files: {},\n      currentUploads: {},\n      foo: 'bar',\n      info: { isHidden: true, message: '', type: 'info' },\n      meta: {},\n      plugins: {},\n      totalProgress: 0\n    })\n  })\n\n  it('should clear all uploads on cancelAll()', () => {\n    const core = new Core()\n    const id = core._createUpload([ 'a', 'b' ])\n\n    expect(core.state.currentUploads[id]).toBeDefined()\n\n    core.cancelAll()\n\n    expect(core.state.currentUploads[id]).toBeUndefined()\n  })\n\n  it('should close, reset and uninstall when the close method is called', () => {\n    const core = new Core()\n    core.use(AcquirerPlugin1)\n\n    // const corePauseEventMock = jest.fn()\n    const coreCancelEventMock = jest.fn()\n    const coreStateUpdateEventMock = jest.fn()\n    // core.on('pause-all', corePauseEventMock)\n    core.on('cancel-all', coreCancelEventMock)\n    core.on('state-update', coreStateUpdateEventMock)\n\n    core.close()\n\n    // expect(corePauseEventMock.mock.calls.length).toEqual(1)\n    expect(coreCancelEventMock.mock.calls.length).toEqual(1)\n    expect(coreStateUpdateEventMock.mock.calls.length).toEqual(1)\n    expect(coreStateUpdateEventMock.mock.calls[0][1]).toEqual({\n      capabilities: { resumableUploads: false },\n      files: {},\n      currentUploads: {},\n      info: { isHidden: true, message: '', type: 'info' },\n      meta: {},\n      plugins: {},\n      totalProgress: 0\n    })\n    expect(core.plugins.acquirer[0].mocks.uninstall.mock.calls.length).toEqual(\n      1\n    )\n  })\n\n  describe('upload hooks', () => {\n    it('should add data returned from upload hooks to the .upload() result', () => {\n      const core = new Core()\n      core.addPreProcessor((fileIDs, uploadID) => {\n        core.addResultData(uploadID, { pre: 'ok' })\n      })\n      core.addPostProcessor((fileIDs, uploadID) => {\n        core.addResultData(uploadID, { post: 'ok' })\n      })\n      core.addUploader((fileIDs, uploadID) => {\n        core.addResultData(uploadID, { upload: 'ok' })\n      })\n      return core.upload().then((result) => {\n        expect(result.pre).toBe('ok')\n        expect(result.upload).toBe('ok')\n        expect(result.post).toBe('ok')\n      })\n    })\n  })\n\n  describe('preprocessors', () => {\n    it('should add a preprocessor', () => {\n      const core = new Core()\n      const preprocessor = function () {}\n      core.addPreProcessor(preprocessor)\n      expect(core.preProcessors[0]).toEqual(preprocessor)\n    })\n\n    it('should remove a preprocessor', () => {\n      const core = new Core()\n      const preprocessor1 = function () {}\n      const preprocessor2 = function () {}\n      const preprocessor3 = function () {}\n      core.addPreProcessor(preprocessor1)\n      core.addPreProcessor(preprocessor2)\n      core.addPreProcessor(preprocessor3)\n      expect(core.preProcessors.length).toEqual(3)\n      core.removePreProcessor(preprocessor2)\n      expect(core.preProcessors.length).toEqual(2)\n    })\n\n    it('should execute all the preprocessors when uploading a file', () => {\n      const core = new Core()\n      const preprocessor1 = jest.fn()\n      const preprocessor2 = jest.fn()\n      core.addPreProcessor(preprocessor1)\n      core.addPreProcessor(preprocessor2)\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      return core.upload()\n        .then(() => {\n          const fileId = Object.keys(core.state.files)[0]\n          expect(preprocessor1.mock.calls.length).toEqual(1)\n\n          expect(preprocessor1.mock.calls[0][0].length).toEqual(1)\n          expect(preprocessor1.mock.calls[0][0][0]).toEqual(fileId)\n\n          expect(preprocessor2.mock.calls[0][0].length).toEqual(1)\n          expect(preprocessor2.mock.calls[0][0][0]).toEqual(fileId)\n        })\n    })\n\n    it('should update the file progress state when preprocess-progress event is fired', () => {\n      const core = new Core()\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      const fileId = Object.keys(core.state.files)[0]\n      const file = core.getFile(fileId)\n      core.emit('preprocess-progress', file, {\n        mode: 'determinate',\n        message: 'something',\n        value: 0\n      })\n      expect(core.state.files[fileId].progress).toEqual({\n        percentage: 0,\n        bytesUploaded: 0,\n        bytesTotal: 17175,\n        uploadComplete: false,\n        uploadStarted: false,\n        preprocess: { mode: 'determinate', message: 'something', value: 0 }\n      })\n    })\n\n    it('should update the file progress state when preprocess-complete event is fired', () => {\n      const core = new Core()\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      const fileID = Object.keys(core.state.files)[0]\n      const file = core.state.files[fileID]\n      core.emit('preprocess-complete', file, {\n        mode: 'determinate',\n        message: 'something',\n        value: 0\n      })\n      expect(core.state.files[fileID].progress).toEqual({\n        percentage: 0,\n        bytesUploaded: 0,\n        bytesTotal: 17175,\n        uploadComplete: false,\n        uploadStarted: false\n      })\n    })\n  })\n\n  describe('postprocessors', () => {\n    it('should add a postprocessor', () => {\n      const core = new Core()\n      const postprocessor = function () {}\n      core.addPostProcessor(postprocessor)\n      expect(core.postProcessors[0]).toEqual(postprocessor)\n    })\n\n    it('should remove a postprocessor', () => {\n      const core = new Core()\n      const postprocessor1 = function () {}\n      const postprocessor2 = function () {}\n      const postprocessor3 = function () {}\n      core.addPostProcessor(postprocessor1)\n      core.addPostProcessor(postprocessor2)\n      core.addPostProcessor(postprocessor3)\n      expect(core.postProcessors.length).toEqual(3)\n      core.removePostProcessor(postprocessor2)\n      expect(core.postProcessors.length).toEqual(2)\n    })\n\n    it('should execute all the postprocessors when uploading a file', () => {\n      const core = new Core()\n      const postprocessor1 = jest.fn()\n      const postprocessor2 = jest.fn()\n      core.addPostProcessor(postprocessor1)\n      core.addPostProcessor(postprocessor2)\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      return core.upload().then(() => {\n        expect(postprocessor1.mock.calls.length).toEqual(1)\n        // const lastModifiedTime = new Date()\n        // const fileId = 'foojpg' + lastModifiedTime.getTime()\n        const fileId = 'uppy-foojpg-image'\n\n        expect(postprocessor1.mock.calls[0][0].length).toEqual(1)\n        expect(postprocessor1.mock.calls[0][0][0].substring(0, 17)).toEqual(\n          fileId.substring(0, 17)\n        )\n\n        expect(postprocessor2.mock.calls[0][0].length).toEqual(1)\n        expect(postprocessor2.mock.calls[0][0][0].substring(0, 17)).toEqual(\n          fileId.substring(0, 17)\n        )\n      })\n    })\n\n    it('should update the file progress state when postprocess-progress event is fired', () => {\n      const core = new Core()\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      const fileId = Object.keys(core.state.files)[0]\n      const file = core.getFile(fileId)\n      core.emit('postprocess-progress', file, {\n        mode: 'determinate',\n        message: 'something',\n        value: 0\n      })\n      expect(core.state.files[fileId].progress).toEqual({\n        percentage: 0,\n        bytesUploaded: 0,\n        bytesTotal: 17175,\n        uploadComplete: false,\n        uploadStarted: false,\n        postprocess: { mode: 'determinate', message: 'something', value: 0 }\n      })\n    })\n\n    it('should update the file progress state when postprocess-complete event is fired', () => {\n      const core = new Core()\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      const fileId = Object.keys(core.state.files)[0]\n      const file = core.state.files[fileId]\n      core.emit('postprocess-complete', file, {\n        mode: 'determinate',\n        message: 'something',\n        value: 0\n      })\n      expect(core.state.files[fileId].progress).toEqual({\n        percentage: 0,\n        bytesUploaded: 0,\n        bytesTotal: 17175,\n        uploadComplete: false,\n        uploadStarted: false\n      })\n    })\n  })\n\n  describe('uploaders', () => {\n    it('should add an uploader', () => {\n      const core = new Core()\n      const uploader = function () {}\n      core.addUploader(uploader)\n      expect(core.uploaders[0]).toEqual(uploader)\n    })\n\n    it('should remove an uploader', () => {\n      const core = new Core()\n      const uploader1 = function () {}\n      const uploader2 = function () {}\n      const uploader3 = function () {}\n      core.addUploader(uploader1)\n      core.addUploader(uploader2)\n      core.addUploader(uploader3)\n      expect(core.uploaders.length).toEqual(3)\n      core.removeUploader(uploader2)\n      expect(core.uploaders.length).toEqual(2)\n    })\n  })\n\n  describe('adding a file', () => {\n    it('should call onBeforeFileAdded if it was specified in the options when initialising the class', () => {\n      const onBeforeFileAdded = jest.fn()\n      const core = new Core({\n        onBeforeFileAdded\n      })\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      expect(onBeforeFileAdded.mock.calls.length).toEqual(1)\n      expect(onBeforeFileAdded.mock.calls[0][0].name).toEqual('foo.jpg')\n      expect(onBeforeFileAdded.mock.calls[0][1]).toEqual({})\n    })\n\n    it('should add a file', () => {\n      const fileData = new File([sampleImage], { type: 'image/jpeg' })\n      const fileAddedEventMock = jest.fn()\n      const core = new Core()\n      core.on('file-added', fileAddedEventMock)\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: fileData\n      })\n\n      const fileId = Object.keys(core.state.files)[0]\n      const newFile = {\n        extension: 'jpg',\n        id: fileId,\n        isRemote: false,\n        meta: { name: 'foo.jpg', type: 'image/jpeg' },\n        name: 'foo.jpg',\n        preview: undefined,\n        data: fileData,\n        progress: {\n          bytesTotal: 17175,\n          bytesUploaded: 0,\n          percentage: 0,\n          uploadComplete: false,\n          uploadStarted: false\n        },\n        remote: '',\n        size: 17175,\n        source: 'jest',\n        type: 'image/jpeg'\n      }\n      expect(core.state.files[fileId]).toEqual(newFile)\n      expect(fileAddedEventMock.mock.calls[0][0]).toEqual(newFile)\n    })\n\n    it('should not allow a file that does not meet the restrictions', () => {\n      const core = new Core({\n        restrictions: {\n          allowedFileTypes: ['image/gif']\n        }\n      })\n      try {\n        core.addFile({\n          source: 'jest',\n          name: 'foo.jpg',\n          type: 'image/jpeg',\n          data: new File([sampleImage], { type: 'image/jpeg' })\n        })\n        throw new Error('File was allowed through')\n      } catch (err) {\n        expect(err.message).toEqual('You can only upload: image/gif')\n      }\n    })\n\n    it('should not allow a file if onBeforeFileAdded returned false', () => {\n      const core = new Core({\n        onBeforeFileAdded: (file, files) => {\n          if (file.source === 'jest') {\n            return false\n          }\n        }\n      })\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n      expect(Object.keys(core.state.files).length).toEqual(0)\n    })\n  })\n\n  describe('uploading a file', () => {\n    it('should return a { successful, failed } pair containing file objects', () => {\n      const core = new Core()\n      core.addUploader((fileIDs) => Promise.resolve())\n\n      core.addFile({ source: 'jest', name: 'foo.jpg', type: 'image/jpeg', data: new Uint8Array() })\n      core.addFile({ source: 'jest', name: 'bar.jpg', type: 'image/jpeg', data: new Uint8Array() })\n\n      return expect(core.upload()).resolves.toMatchObject({\n        successful: [\n          { name: 'foo.jpg' },\n          { name: 'bar.jpg' }\n        ],\n        failed: []\n      })\n    })\n\n    it('should return files with errors in the { failed } key', () => {\n      const core = new Core()\n      core.addUploader((fileIDs) => {\n        fileIDs.forEach((fileID) => {\n          const file = core.getFile(fileID)\n          if (/bar/.test(file.name)) {\n            core.emit('upload-error', file, new Error('This is bar and I do not like bar'))\n          }\n        })\n        return Promise.resolve()\n      })\n\n      core.addFile({ source: 'jest', name: 'foo.jpg', type: 'image/jpeg', data: new Uint8Array() })\n      core.addFile({ source: 'jest', name: 'bar.jpg', type: 'image/jpeg', data: new Uint8Array() })\n\n      return expect(core.upload()).resolves.toMatchObject({\n        successful: [\n          { name: 'foo.jpg' }\n        ],\n        failed: [\n          { name: 'bar.jpg', error: 'This is bar and I do not like bar' }\n        ]\n      })\n    })\n\n    it('should only upload files that are not already assigned to another upload id', () => {\n      const core = new Core()\n      core.store.state.currentUploads = {\n        upload1: {\n          fileIDs: ['uppy-file1jpg-image/jpeg', 'uppy-file2jpg-image/jpeg', 'uppy-file3jpg-image/jpeg']\n        },\n        upload2: {\n          fileIDs: ['uppy-file4jpg-image/jpeg', 'uppy-file5jpg-image/jpeg', 'uppy-file6jpg-image/jpeg']\n        }\n      }\n      core.addUploader((fileIDs) => Promise.resolve())\n\n      core.addFile({ source: 'jest', name: 'foo.jpg', type: 'image/jpeg', data: new Uint8Array() })\n      core.addFile({ source: 'jest', name: 'bar.jpg', type: 'image/jpeg', data: new Uint8Array() })\n      core.addFile({ source: 'file3', name: 'file3.jpg', type: 'image/jpeg', data: new Uint8Array() })\n\n      return expect(core.upload()).resolves.toMatchSnapshot()\n    })\n\n    it('should not upload if onBeforeUpload returned false', () => {\n      const core = new Core({\n        autoProceed: false,\n        onBeforeUpload: (files) => {\n          for (var fileId in files) {\n            if (files[fileId].name === '123.foo') {\n              return false\n            }\n          }\n        }\n      })\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n      core.addFile({\n        source: 'jest',\n        name: 'bar.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n      core.addFile({\n        source: 'jest',\n        name: '123.foo',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n      return core.upload().catch((err) => {\n        expect(err).toMatchObject(new Error('Not starting the upload because onBeforeUpload returned false'))\n      })\n    })\n  })\n\n  describe('removing a file', () => {\n    it('should remove the file', () => {\n      const fileRemovedEventMock = jest.fn()\n\n      const core = new Core()\n      core.on('file-removed', fileRemovedEventMock)\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      const fileId = Object.keys(core.state.files)[0]\n      expect(Object.keys(core.state.files).length).toEqual(1)\n      core.setState({\n        totalProgress: 50\n      })\n\n      const file = core.getFile(fileId)\n      core.removeFile(fileId)\n\n      expect(Object.keys(core.state.files).length).toEqual(0)\n      expect(fileRemovedEventMock.mock.calls[0][0]).toEqual(file)\n      expect(core.state.totalProgress).toEqual(0)\n    })\n  })\n\n  describe('restoring a file', () => {\n    xit('should restore a file', () => {})\n\n    xit(\"should fail to restore a file if it doesn't exist\", () => {})\n  })\n\n  describe('get a file', () => {\n    it('should get the specified file', () => {\n      const core = new Core()\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      const fileId = Object.keys(core.state.files)[0]\n      expect(core.getFile(fileId).name).toEqual('foo.jpg')\n\n      expect(core.getFile('non existant file')).toEqual(undefined)\n    })\n  })\n\n  describe('getFiles', () => {\n    it('should return an empty array if there are no files', () => {\n      const core = new Core()\n\n      expect(core.getFiles()).toEqual([])\n    })\n\n    it('should return all files as an array', () => {\n      const core = new Core()\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n      core.addFile({\n        source: 'jest',\n        name: 'empty.dat',\n        type: 'application/octet-stream',\n        data: new File([Buffer.alloc(1000)], { type: 'application/octet-stream' })\n      })\n\n      expect(core.getFiles()).toHaveLength(2)\n      expect(core.getFiles().map((file) => file.name).sort()).toEqual(['empty.dat', 'foo.jpg'])\n    })\n  })\n\n  describe('meta data', () => {\n    it('should set meta data by calling setMeta', () => {\n      const core = new Core({\n        meta: { foo2: 'bar2' }\n      })\n      core.setMeta({ foo: 'bar', bur: 'mur' })\n      core.setMeta({ boo: 'moo', bur: 'fur' })\n      expect(core.state.meta).toEqual({\n        foo: 'bar',\n        foo2: 'bar2',\n        boo: 'moo',\n        bur: 'fur'\n      })\n    })\n\n    it('should update meta data for a file by calling updateMeta', () => {\n      const core = new Core()\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      const fileId = Object.keys(core.state.files)[0]\n      core.setFileMeta(fileId, { foo: 'bar', bur: 'mur' })\n      core.setFileMeta(fileId, { boo: 'moo', bur: 'fur' })\n      expect(core.state.files[fileId].meta).toEqual({\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        foo: 'bar',\n        bur: 'fur',\n        boo: 'moo'\n      })\n    })\n\n    it('should merge meta data when add file', () => {\n      const core = new Core({\n        meta: { foo2: 'bar2' }\n      })\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        meta: {\n          resize: 5000\n        },\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n      const fileId = Object.keys(core.state.files)[0]\n      expect(core.state.files[fileId].meta).toEqual({\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        foo2: 'bar2',\n        resize: 5000\n      })\n    })\n  })\n\n  describe('progress', () => {\n    it('should calculate the progress of a file upload', () => {\n      const core = new Core()\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      const fileId = Object.keys(core.state.files)[0]\n      const file = core.getFile(fileId)\n      core._calculateProgress(file, {\n        bytesUploaded: 12345,\n        bytesTotal: 17175\n      })\n      expect(core.state.files[fileId].progress).toEqual({\n        percentage: 71,\n        bytesUploaded: 12345,\n        bytesTotal: 17175,\n        uploadComplete: false,\n        uploadStarted: false\n      })\n\n      core._calculateProgress(file, {\n        bytesUploaded: 17175,\n        bytesTotal: 17175\n      })\n      expect(core.state.files[fileId].progress).toEqual({\n        percentage: 100,\n        bytesUploaded: 17175,\n        bytesTotal: 17175,\n        uploadComplete: false,\n        uploadStarted: false\n      })\n    })\n\n    it('should calculate the total progress of all file uploads', () => {\n      const core = new Core()\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n      core.addFile({\n        source: 'jest',\n        name: 'foo2.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      const fileId1 = Object.keys(core.state.files)[0]\n      const fileId2 = Object.keys(core.state.files)[1]\n      const file1 = core.state.files[fileId1]\n      const file2 = core.state.files[fileId2]\n      core.state.files[fileId1].progress.uploadStarted = new Date()\n      core.state.files[fileId2].progress.uploadStarted = new Date()\n\n      core._calculateProgress(file1, {\n        bytesUploaded: 12345,\n        bytesTotal: 17175\n      })\n\n      core._calculateProgress(file2, {\n        bytesUploaded: 10201,\n        bytesTotal: 17175\n      })\n\n      core._calculateTotalProgress()\n      expect(core.state.totalProgress).toEqual(65)\n    })\n\n    it('should reset the progress', () => {\n      const resetProgressEvent = jest.fn()\n      const core = new Core()\n      core.on('reset-progress', resetProgressEvent)\n\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n      core.addFile({\n        source: 'jest',\n        name: 'foo2.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      const fileId1 = Object.keys(core.state.files)[0]\n      const fileId2 = Object.keys(core.state.files)[1]\n      const file1 = core.state.files[fileId1]\n      const file2 = core.state.files[fileId2]\n      core.state.files[fileId1].progress.uploadStarted = new Date()\n      core.state.files[fileId2].progress.uploadStarted = new Date()\n\n      core._calculateProgress(file1, {\n        bytesUploaded: 12345,\n        bytesTotal: 17175\n      })\n\n      core._calculateProgress(file2, {\n        bytesUploaded: 10201,\n        bytesTotal: 17175\n      })\n\n      core._calculateTotalProgress()\n\n      expect(core.state.totalProgress).toEqual(65)\n\n      core.resetProgress()\n\n      expect(core.state.files[fileId1].progress).toEqual({\n        percentage: 0,\n        bytesUploaded: 0,\n        bytesTotal: 17175,\n        uploadComplete: false,\n        uploadStarted: false\n      })\n      expect(core.state.files[fileId2].progress).toEqual({\n        percentage: 0,\n        bytesUploaded: 0,\n        bytesTotal: 17175,\n        uploadComplete: false,\n        uploadStarted: false\n      })\n      expect(core.state.totalProgress).toEqual(0)\n      expect(resetProgressEvent.mock.calls.length).toEqual(1)\n    })\n  })\n\n  describe('checkRestrictions', () => {\n    it('should enforce the maxNumberOfFiles rule', () => {\n      const core = new Core({\n        autoProceed: false,\n        restrictions: {\n          maxNumberOfFiles: 1\n        }\n      })\n\n      // add 2 files\n      core.addFile({\n        source: 'jest',\n        name: 'foo1.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n      try {\n        core.addFile({\n          source: 'jest',\n          name: 'foo2.jpg',\n          type: 'image/jpeg',\n          data: new File([sampleImage], { type: 'image/jpeg' })\n        })\n        throw new Error('should have thrown')\n      } catch (err) {\n        expect(err).toMatchObject(new Error('You can only upload 1 file'))\n        expect(core.state.info.message).toEqual('You can only upload 1 file')\n      }\n    })\n\n    xit('should enforce the minNumberOfFiles rule', () => {})\n\n    it('should enforce the allowedFileTypes rule', () => {\n      const core = new Core({\n        autoProceed: false,\n        restrictions: {\n          allowedFileTypes: ['image/gif', 'image/png']\n        }\n      })\n\n      try {\n        core.addFile({\n          source: 'jest',\n          name: 'foo2.jpg',\n          type: 'image/jpeg',\n          data: new File([sampleImage], { type: 'image/jpeg' })\n        })\n        throw new Error('should have thrown')\n      } catch (err) {\n        expect(err).toMatchObject(new Error('You can only upload: image/gif, image/png'))\n        expect(core.state.info.message).toEqual('You can only upload: image/gif, image/png')\n      }\n    })\n\n    it('should enforce the allowedFileTypes rule with file extensions', () => {\n      const core = new Core({\n        autoProceed: false,\n        restrictions: {\n          allowedFileTypes: ['.gif', '.jpg', '.jpeg']\n        }\n      })\n\n      try {\n        core.addFile({\n          source: 'jest',\n          name: 'foo2.png',\n          type: '',\n          data: new File([sampleImage], { type: 'image/jpeg' })\n        })\n        throw new Error('should have thrown')\n      } catch (err) {\n        expect(err).toMatchObject(new Error('You can only upload: .gif, .jpg, .jpeg'))\n        expect(core.state.info.message).toEqual('You can only upload: .gif, .jpg, .jpeg')\n      }\n    })\n\n    it('should enforce the maxFileSize rule', () => {\n      const core = new Core({\n        autoProceed: false,\n        restrictions: {\n          maxFileSize: 1234\n        }\n      })\n\n      try {\n        core.addFile({\n          source: 'jest',\n          name: 'foo.jpg',\n          type: 'image/jpeg',\n          data: new File([sampleImage], { type: 'image/jpeg' })\n        })\n        throw new Error('should have thrown')\n      } catch (err) {\n        expect(err).toMatchObject(new Error('This file exceeds maximum allowed size of 1.2 KB'))\n        expect(core.state.info.message).toEqual('This file exceeds maximum allowed size of 1.2 KB')\n      }\n    })\n  })\n\n  describe('actions', () => {\n    it('should update the state when receiving the error event', () => {\n      const core = new Core()\n      core.emit('error', new Error('foooooo'))\n      expect(core.state.error).toEqual('foooooo')\n    })\n\n    it('should update the state when receiving the upload-error event', () => {\n      const core = new Core()\n      core.state.files['fileId'] = {\n        name: 'filename'\n      }\n      core.emit('upload-error', core.state.files['fileId'], new Error('this is the error'))\n      expect(core.state.info).toEqual({'message': 'Failed to upload filename', 'details': 'this is the error', 'isHidden': false, 'type': 'error'})\n    })\n\n    it('should reset the error state when receiving the upload event', () => {\n      const core = new Core()\n      core.emit('error', { foo: 'bar' })\n      core.emit('upload')\n      expect(core.state.error).toEqual(null)\n    })\n  })\n\n  describe('updateOnlineStatus', () => {\n    const RealNavigatorOnline = global.window.navigator.onLine\n\n    function mockNavigatorOnline (status) {\n      Object.defineProperty(\n        global.window.navigator,\n        'onLine',\n        {\n          value: status,\n          writable: true\n        }\n      )\n    }\n\n    afterEach(() => {\n      global.window.navigator.onLine = RealNavigatorOnline\n    })\n\n    it('should emit the correct event based on whether there is a network connection', () => {\n      const onlineEventMock = jest.fn()\n      const offlineEventMock = jest.fn()\n      const backOnlineEventMock = jest.fn()\n      const core = new Core()\n      core.on('is-offline', offlineEventMock)\n      core.on('is-online', onlineEventMock)\n      core.on('back-online', backOnlineEventMock)\n\n      mockNavigatorOnline(true)\n      core.updateOnlineStatus()\n      expect(onlineEventMock.mock.calls.length).toEqual(1)\n      expect(offlineEventMock.mock.calls.length).toEqual(0)\n      expect(backOnlineEventMock.mock.calls.length).toEqual(0)\n\n      mockNavigatorOnline(false)\n      core.updateOnlineStatus()\n      expect(onlineEventMock.mock.calls.length).toEqual(1)\n      expect(offlineEventMock.mock.calls.length).toEqual(1)\n      expect(backOnlineEventMock.mock.calls.length).toEqual(0)\n\n      mockNavigatorOnline(true)\n      core.updateOnlineStatus()\n      expect(onlineEventMock.mock.calls.length).toEqual(2)\n      expect(offlineEventMock.mock.calls.length).toEqual(1)\n      expect(backOnlineEventMock.mock.calls.length).toEqual(1)\n    })\n  })\n\n  describe('info', () => {\n    it('should set a string based message to be displayed infinitely', () => {\n      const infoVisibleEvent = jest.fn()\n      const core = new Core()\n      core.on('info-visible', infoVisibleEvent)\n\n      core.info('This is the message', 'info', 0)\n      expect(core.state.info).toEqual({\n        isHidden: false,\n        type: 'info',\n        message: 'This is the message',\n        details: null\n      })\n      expect(infoVisibleEvent.mock.calls.length).toEqual(1)\n      expect(typeof core.infoTimeoutID).toEqual('undefined')\n    })\n\n    it('should set a object based message to be displayed infinitely', () => {\n      const infoVisibleEvent = jest.fn()\n      const core = new Core()\n      core.on('info-visible', infoVisibleEvent)\n\n      core.info({\n        message: 'This is the message',\n        details: {\n          foo: 'bar'\n        }\n      }, 'warning', 0)\n      expect(core.state.info).toEqual({\n        isHidden: false,\n        type: 'warning',\n        message: 'This is the message',\n        details: {\n          foo: 'bar'\n        }\n      })\n      expect(infoVisibleEvent.mock.calls.length).toEqual(1)\n      expect(typeof core.infoTimeoutID).toEqual('undefined')\n    })\n\n    it('should set an info message to be displayed for a period of time before hiding', (done) => {\n      const infoVisibleEvent = jest.fn()\n      const infoHiddenEvent = jest.fn()\n      const core = new Core()\n      core.on('info-visible', infoVisibleEvent)\n      core.on('info-hidden', infoHiddenEvent)\n\n      core.info('This is the message', 'info', 100)\n      expect(typeof core.infoTimeoutID).toEqual('number')\n      expect(infoHiddenEvent.mock.calls.length).toEqual(0)\n      setTimeout(() => {\n        expect(infoHiddenEvent.mock.calls.length).toEqual(1)\n        expect(core.state.info).toEqual({\n          isHidden: true,\n          type: 'info',\n          message: 'This is the message',\n          details: null\n        })\n        done()\n      }, 110)\n    })\n\n    it('should hide an info message', () => {\n      const infoVisibleEvent = jest.fn()\n      const infoHiddenEvent = jest.fn()\n      const core = new Core()\n      core.on('info-visible', infoVisibleEvent)\n      core.on('info-hidden', infoHiddenEvent)\n\n      core.info('This is the message', 'info', 0)\n      expect(typeof core.infoTimeoutID).toEqual('undefined')\n      expect(infoHiddenEvent.mock.calls.length).toEqual(0)\n      core.hideInfo()\n      expect(infoHiddenEvent.mock.calls.length).toEqual(1)\n      expect(core.state.info).toEqual({\n        isHidden: true,\n        type: 'info',\n        message: 'This is the message',\n        details: null\n      })\n    })\n  })\n\n  describe('createUpload', () => {\n    it('should assign the specified files to a new upload', () => {\n      const core = new Core()\n      core.addFile({\n        source: 'jest',\n        name: 'foo.jpg',\n        type: 'image/jpeg',\n        data: new File([sampleImage], { type: 'image/jpeg' })\n      })\n\n      core._createUpload(Object.keys(core.state.files))\n      const uploadId = Object.keys(core.state.currentUploads)[0]\n      const currentUploadsState = {}\n      currentUploadsState[uploadId] = {\n        fileIDs: Object.keys(core.state.files),\n        step: 0,\n        result: {}\n      }\n      expect(core.state.currentUploads).toEqual(currentUploadsState)\n    })\n  })\n\n  describe('i18n', () => {\n    it('merges in custom locale strings', () => {\n      const core = new Core({\n        locale: {\n          strings: {\n            test: 'beep boop'\n          }\n        }\n      })\n\n      expect(core.i18n('exceedsSize')).toBe('This file exceeds maximum allowed size of')\n      expect(core.i18n('test')).toBe('beep boop')\n    })\n  })\n\n  describe('default restrictions', () => {\n    it('should be merged with supplied restrictions', () => {\n      const core = new Core({\n        restrictions: {\n          maxNumberOfFiles: 3\n        }\n      })\n\n      expect(core.opts.restrictions.maxNumberOfFiles).toBe(3)\n      expect(core.opts.restrictions.minNumberOfFiles).toBe(null)\n    })\n  })\n})\n"]}